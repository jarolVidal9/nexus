<form class="w-full scroll-auto rounded-sm shadow-lg bg-base-100 overflow-hidden" [formGroup]="createGoalForm" (ngSubmit)="onSubmit()">
    <!-- Imagen de la meta -->
    <div class="h-48 w-full flex items-center justify-between relative group">
        <!-- Etiqueta de estado a la izquierda -->
        <div class="absolute top-2 left-2 z-10">
            @switch (createGoalForm.get('state')?.value) {
                @case ('proceso') {
                    <span class="bg-yellow-500 text-white px-2 py-0.5 rounded-full text-xs">En proceso</span>
                }
                @case ('completada') {
                    <span class="bg-green-500 text-white px-2 py-0.5 rounded-full text-xs">Completada</span>
                }
                @case ('vencida') {
                    <span class="bg-red-500 text-white px-2 py-0.5 rounded-full text-xs">Vencida</span>
                }
                @default {
                    <span class="bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full text-xs">Sin estado</span>
                }
            }
        </div>
        <label class="cursor-pointer flex flex-col items-center justify-center w-full h-full">
            <input type="file" accept="image/*" class="hidden" (change)="onFileSelected($event)" />
            @if(imgPath() || previewImg()) {
                <div class="relative w-full h-full">
                    <img [src]="imgPath() || previewImg()" class="w-full h-full object-contain rounded-tl-lg rounded-tr-lg " alt="Meta" />
                    <button type="button"
                        class="absolute top-2 right-2 bg-white bg-opacity-80 rounded-full p-1 shadow hover:bg-red-500 hover:text-white transition flex items-center gap-1"
                        (click)="removeImage()"
                        title="Eliminar imagen">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                        <span class="text-xs font-semibold">Quitar Imagen</span>
                    </button>
                </div>
            }@else {
                <div class="flex flex-col items-center justify-center w-full h-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-400 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <rect x="3" y="5" width="18" height="14" rx="3" fill="#e5e7eb"/>
                        <circle cx="8" cy="13" r="2" fill="#9ca3af"/>
                        <path d="M21 19l-5.5-7-4.5 6-3-4-4 5" stroke="#9ca3af" stroke-width="2" fill="none"/>
                    </svg>
                    <span class="text-gray-400 text-xs">Aquí aparecerá la imagen de tu meta</span>
                </div>
            }
        </label>
    </div>    <!-- Contenido del formulario -->
    <div class="p-6 space-y-4">
        <!-- Título -->
        <div class="flex flex-col">
            <input
                type="text"
                placeholder="¿Cuál es tu meta?"
                formControlName="title"
                class="w-full text-2xl font-bold input border-b-2 border-blue-200 focus:outline-none focus:border-blue-400 placeholder-gray-400"
            />
            <span class="text-xs text-red-500 mt-1 min-h-[1.5em] block">
                @if(createGoalForm.get('title')?.touched) {
                    {{createGoalForm.get('title')?.errors?.['required'] ? 'El título es obligatorio' : ''}}
                    {{createGoalForm.get('title')?.errors?.['minlength'] ? 'El título debe tener al menos 3 caracteres' : ''}}
                    {{createGoalForm.get('title')?.errors?.['maxlength'] ? 'El título no puede tener más de 50 caracteres' : ''}}
                }
            </span>
        </div>    
        
        <!-- Prioridad -->
        <div class="flex flex-col">
            <div class="flex items-center gap-3">
                <label class="text-sm font-medium " for="priority">Prioridad:</label>
                <select formControlName="priority"
                    class="select select-xs px-3 py-1 rounded-full text-xs w-30"
                >
                    <option value="" disabled>Selecciona</option>
                    <option value="alta">Alta</option>
                    <option value="media">Media</option>
                    <option value="baja">Baja</option>
                </select>
                <span class="text-xs text-red-500 ml-2 min-w-[8em]">
                    @if(createGoalForm.get('priority')?.touched) {
                        {{createGoalForm.get('priority')?.errors?.['required'] ? 'La prioridad es obligatoria' : ''}}
                    }
                </span>
            </div>
        </div>

        <!-- Avance y meta -->
        <div>
            <div class="flex flex-col gap-2 mb-2">
                <div class="flex gap-2">
                    <div class="flex-1">
                        <label class="text-xs mb-1 block" for="progress">Progreso</label>
                        <input
                            formControlName="progress"
                            type="number"
                            min="0"
                            placeholder="0"
                            class="w-full input input-sm"
                        />
                    </div>
                    <div class="flex-1">
                        <label class="text-xs mb-1 block" for="objective">Objetivo</label>
                        <input
                            formControlName="objective"
                            type="number"
                            min="1"
                            placeholder="Meta"
                            class="w-full input input-sm"
                        />
                    </div>
                    <div class="flex-1">
                        <label class="text-xs mb-1 block" for="unit">Unidad</label>
                        <input
                            formControlName="unit"
                            type="text"
                            placeholder="Unidad"
                            class="w-full input input-sm"
                        />
                    </div>
                </div>
                <span class="text-xs text-red-500  block">
                    @if(createGoalForm.touched) {
                        {{ createGoalForm.errors?.['progress'] ? createGoalForm.errors?.['progress'] : '' }}
                    }
                </span>        
                <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden mt-1">
                    <div
                        class="h-full bg-green-500 transition-all duration-500 ease-in-out"
                        [style.width]="createGoalForm.get('progress')?.value && createGoalForm.get('objective')?.value ? (createGoalForm.get('progress')?.value / createGoalForm.get('objective')?.value * 100) + '%' : '0%'"
                    ></div>    </div>
            </div>
        </div>
        <!-- Fecha límite -->
        <div class="flex items-center gap-2 text-sm text-gray-600">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            <label class="text-xs font-bold" for="dueDate">Fecha Límite</label>
            
            <input
                formControlName="dueDate"
                type="date"
                class="input input-sm w-30"
            />
            @if(createGoalForm.get('dueDate')?.touched) {
                <span class="text-xs text-red-500 mt-1 block">
                    {{createGoalForm.get('dueDate')?.errors?.['required'] ? 'La fecha límite es obligatoria' : ''}}
                </span>
                <span class="text-xs text-red-500 mt-1 block">
                    {{createGoalForm.get('dueDate')?.errors?.['date'] ? 'La fecha debe ser mayor a la actual' : ''}}
                </span>
            }
        </div>

        <!-- Etiquetas -->
        <div class="flex items-center gap-2 text-sm">
            <input
                type="text"
                placeholder="Etiquetas (separadas por coma)"
                class="w-full input px-2 py-1 rounded-full text-xs focus:outline-none"
            />
        </div>

        <!-- Notas -->
        <textarea
            placeholder="Notas o descripción.."
            class="w-full mt-2 p-2 border textarea border-gray-300 rounded-xl text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-200"
            rows="3"
            formControlName="description"
        ></textarea>
        <span class="text-xs text-red-500 block">
            @if(createGoalForm.get('description')?.touched) {
                {{createGoalForm.get('description')?.errors?.['maxlength'] ? 'La descripción no puede tener más de 250 caracteres' : ''}}
            }
        </span>    
        @if (errorMessages()) {
            @for(err of errorMessages(); track $index) {
                <div role="alert" class="alert alert-error text-xs alert-soft p-2 rounded-md bg-red-100 text-red-700">
                    <span>{{err.msg}}</span>
                </div>
            }
        }
        <!-- Botón guardar -->
        <div class="flex justify-end pt-2">
            <button [disabled]="createGoalForm.invalid || !createGoalForm.dirty" type="submit" class="btn btn-primary px-6 py-2 rounded-lg shadow font-semibold">
                @if(loading()) {
                    <span class="loading loading-spinner loading-sm"></span>
                }
                Guardar
            </button>
        </div>
    </div>
</form>
    