<div class="p-6 flex flex-col gap-6  mx-auto">

  <!-- Filtros por Fecha -->
  <form
    class="flex flex-col md:flex-row justify-between gap-4 items-stretch w-full bg-base-200  p-6 rounded-lg shadow-md"
    [formGroup]="filterForm" (ngSubmit)="onFilter()">
    <div class="flex flex-col md:flex-row gap-4 items-stretch w-full md:w-auto">
      <div class="flex flex-col md:flex-row items-center gap-2 w-full md:w-auto">
        <label for="startDate" class="text-sm font-medium">Fecha Inicio:</label>
        <input type="date" id="startDate" class="p-2 input input-sm w-full md:w-auto" formControlName="startDate">
      </div>
      <div class="flex flex-col md:flex-row items-center gap-2 w-full md:w-auto">
        <label for="endDate" class="text-sm font-medium">Fecha Fin:</label>
        <input type="date" id="endDate" class="p-2 input w-full input-sm md:w-auto" formControlName="endDate">
      </div>
    </div>
    <button
      class="flex items-center justify-center btn btn-primary btn-sm px-6 py-2 rounded-lg transition w-full md:w-auto"
      [disabled]="filterForm.invalid || loadingStatistics()">
      <i class="fas fa-filter mr-2"></i>
      Filtrar
    </button>
  </form>


  <!-- Tarjetas de resumen -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    @if(loadingStatistics()){
    <div class="bg-green-100 p-6 rounded-lg shadow-md">
      <div class="h-4 w-1/2 bg-green-300 rounded mb-2"></div>
      <div class="h-8 w-3/4 bg-green-300 rounded"></div>
    </div>
    <div class="bg-red-100 p-6 rounded-lg shadow-md">
      <div class="h-4 w-1/2 bg-red-300 rounded mb-2"></div>
      <div class="h-8 w-3/4 bg-red-300 rounded"></div>
    </div>
    <div class="bg-blue-100 p-6 rounded-lg shadow-md">
      <div class="h-4 w-1/2 bg-blue-300 rounded mb-2"></div>
      <div class="h-8 w-3/4 bg-blue-300 rounded"></div>
    </div>
    }@else {
    <div class="bg-green-100 text-green-800 p-6 rounded-lg shadow-md">
      <p class="text-sm font-semibold">Ingresos Totales</p>
      <p class="text-2xl font-bold mt-2">{{ totalIncome() | currency }}</p>
    </div>
    <div class="bg-red-100 text-red-800 p-6 rounded-lg shadow-md">
      <p class="text-sm font-semibold">Gastos Totales</p>
      <p class="text-2xl font-bold mt-2"> {{ totalExpense() | currency }}</p>
    </div>
    <div class="bg-blue-100 text-blue-800 p-6 rounded-lg shadow-md">
      <p class="text-sm font-semibold">Saldo Neto</p>
      <p class="text-2xl font-bold mt-2">{{ balance() | currency}}</p>
    </div>
    }
  </div>


  <!-- Gr치ficos -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="bg-base-200 p-6 rounded-lg shadow-md">
      <p class="text-lg font-semibold mb-4 ">Distribuci칩n de Gastos</p>
      <div class="h-48 flex items-center justify-center text-gray-400">[Gr치fico Pastel]</div>
    </div>
    <div class="bg-base-200 p-6 rounded-lg shadow-md">
      <p class="text-lg font-semibold mb-4 ">Ingresos vs. Gastos</p>
      <div class="h-48 flex items-center justify-center text-gray-400">[Gr치fico Barras]</div>
    </div>
  </div>

  <!-- Historial de Movimientos -->
  <div class="bg-base-200 p-6 rounded-lg shadow-md">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold ">Historial de Movimientos</h2>
      <button (click)="openAddMovementModal()"
        class="flex items-center gap-2 btn btn-primary btn-sm px-4 py-2 rounded-lg transition focus:outline-none">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
        </svg>
        Agregar
      </button>
    </div>
    @if(loadingMovements()){
    <div class="flex items-center justify-center py-8">
      <span class="loading loading-spinner loading-xl"></span>
      <span class="text-gray-500 text-lg">Cargando movimientos...</span>
    </div>
    }@else{
    <div class="rounded-xl divide-y">
      <!-- Movimiento Individual -->
      @if(movements().length > 0){
      @for (movement of movements(); track movement.id) {
      <div class="flex flex-col md:flex-row md:items-center justify-between p-4 hover:bg-base-100 transition gap-2 md:gap-0">
        <div class="flex items-center gap-3 flex-1 min-w-0">
          @if(movement.type === 'ingreso'){
          <div class="p-2 rounded-full bg-green-500 text-green-100 flex-shrink-0">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v8m0 0l-3-3m3 3l3-3" />
        </svg>
          </div>
          }@else {
          <div class="p-2 rounded-full bg-red-500 text-red-100 flex-shrink-0">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 16V8m0 0l3 3m-3-3l-3 3" />
        </svg>
          </div>
          }
          <span class="text-sm font-medium truncate">{{ movement.title }}</span>
          <span class="text-xs px-2 py-1 rounded bg-gray-200 text-gray-600 hidden sm:inline">ninguna</span>
        </div>
        <div class="flex flex-wrap md:flex-nowrap items-center gap-2 md:gap-6 mt-2 md:mt-0">
          <span class="text-sm font-semibold min-w-[80px] text-right">{{ movement.amount | currency }}</span>
          <span class="text-xs text-gray-500 min-w-[90px] text-right">{{ movement.date | date }}</span>
          <div class="flex gap-2">
        <button type="button" class="btn btn-outline btn-info btn-xs md:btn-sm" (click)="openEditMovementModal(movement)">
          <i class="fas fa-pencil"></i> <span class="hidden md:inline">Editar</span>
        </button>
        <button type="button" class="btn btn-outline btn-error btn-xs md:btn-sm" (click)="deleteMovement(movement.id)">
          <i class="fas fa-trash"></i> <span class="hidden md:inline">Eliminar</span>
        </button>
          </div>
        </div>
      </div>
      }
      }@else {
      <div class="flex items-center justify-center py-8">
        <span class="text-gray-500 text-lg">No hay movimientos registrados</span>
      </div>
      }
    </div>
    }
  </div>
</div>